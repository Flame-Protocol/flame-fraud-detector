<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FLAME Protocol | Client Submission Analysis System</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
    <style>
        :root {
            --bg-primary: #0a0e14;
            --bg-secondary: #0d1117;
            --bg-tertiary: #161b22;
            --border: #30363d;
            --text-primary: #e6edf3;
            --text-secondary: #8b949e;
            --accent-blue: #58a6ff;
            --accent-green: #3fb950;
            --accent-red: #f85149;
            --accent-orange: #d29922;
            --accent-purple: #a371f7;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
        }
        
        /* Header */
        .header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            padding: 12px 24px;
        }
        .header-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1600px;
            margin: 0 auto;
        }
        .brand { font-size: 16px; font-weight: 700; color: var(--accent-blue); letter-spacing: 2px; }
        .brand-sub { font-size: 10px; color: var(--text-secondary); margin-top: 2px; }
        .header-meta {
            display: flex;
            gap: 20px;
            font-size: 11px;
            color: var(--text-secondary);
        }
        .header-meta span { color: var(--accent-green); }
        .status-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: var(--accent-green);
            border-radius: 50%;
            margin-right: 4px;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .nav-row {
            display: flex;
            gap: 5px;
            margin-top: 12px;
            max-width: 1600px;
            margin-left: auto;
            margin-right: auto;
        }
        .nav-item {
            padding: 8px 16px;
            font-size: 12px;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .nav-item:hover, .nav-item.active {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }
        
        /* Main Grid */
        .app-grid {
            display: grid;
            grid-template-columns: 320px 1fr 350px;
            gap: 20px;
            max-width: 1600px;
            margin: 20px auto;
            padding: 0 20px;
            min-height: calc(100vh - 120px);
        }
        
        /* Panels */
        .panel {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
        }
        .section {
            padding: 16px;
            border-bottom: 1px solid var(--border);
        }
        .section:last-child { border-bottom: none; }
        .section-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
        }
        
        /* Upload Zone */
        .upload-zone {
            border: 2px dashed var(--border);
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        .upload-zone:hover, .upload-zone.dragover {
            border-color: var(--accent-blue);
            background: rgba(88, 166, 255, 0.05);
        }
        .upload-icon { font-size: 36px; margin-bottom: 10px; }
        .upload-text { font-size: 13px; color: var(--text-primary); margin-bottom: 5px; }
        .upload-hint { font-size: 11px; color: var(--text-secondary); }
        .file-input { display: none; }
        
        /* Progress Bar */
        .progress-bar {
            height: 4px;
            background: var(--bg-tertiary);
            border-radius: 2px;
            margin-top: 12px;
            overflow: hidden;
            display: none;
        }
        .progress-bar.active { display: block; }
        .progress-fill {
            height: 100%;
            background: var(--accent-blue);
            width: 0%;
            transition: width 0.3s;
        }
        
        /* File List */
        .file-list { margin-top: 12px; }
        .file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 12px;
            background: var(--bg-tertiary);
            border-radius: 6px;
            margin-bottom: 6px;
            font-size: 12px;
        }
        .file-name { color: var(--text-primary); }
        .file-status { color: var(--accent-green); font-size: 10px; }
        .file-status.error { color: var(--accent-red); }
        .file-status.processing { color: var(--accent-orange); }
        
        /* Document Types */
        .doc-types {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 12px;
        }
        .doc-type {
            padding: 10px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 11px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        .doc-type:hover { border-color: var(--accent-blue); }
        .doc-type.selected { border-color: var(--accent-green); background: rgba(63, 185, 80, 0.1); }
        .doc-type-icon { font-size: 20px; margin-bottom: 4px; }
        
        /* Text Area */
        .input-box {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        .input-header {
            display: flex;
            justify-content: space-between;
            padding: 12px 16px;
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border);
        }
        .input-label { font-size: 12px; font-weight: 600; }
        .input-meta { font-size: 11px; color: var(--text-secondary); }
        .input-area {
            flex: 1;
            background: var(--bg-secondary);
            border: none;
            color: var(--text-primary);
            padding: 16px;
            font-family: 'Consolas', monospace;
            font-size: 12px;
            line-height: 1.6;
            resize: none;
            min-height: 300px;
        }
        .input-area:focus { outline: none; }
        .input-area::placeholder { color: var(--text-secondary); }
        
        /* Buttons */
        .btn-row {
            display: flex;
            gap: 10px;
            padding: 12px 16px;
            background: var(--bg-tertiary);
            border-top: 1px solid var(--border);
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-primary { background: var(--accent-green); color: #000; }
        .btn-primary:hover { background: #2ea043; }
        .btn-secondary { background: var(--bg-primary); color: var(--text-primary); border: 1px solid var(--border); }
        .btn-secondary:hover { background: var(--border); }
        .btn-danger { background: var(--accent-red); color: #fff; }
        
        /* Results */
        .results { display: none; }
        .results.active { display: block; }
        .result-card {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-bottom: 12px;
            overflow: hidden;
        }
        .result-header {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .result-title { font-size: 12px; font-weight: 600; }
        .result-body { padding: 16px; }
        
        /* Score Display */
        .score-display {
            text-align: center;
            padding: 30px;
        }
        .score-value {
            font-size: 72px;
            font-weight: 700;
            line-height: 1;
        }
        .score-low { color: var(--accent-green); }
        .score-medium { color: var(--accent-orange); }
        .score-high { color: var(--accent-red); }
        .verdict {
            display: inline-block;
            padding: 8px 20px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 700;
            margin-top: 15px;
        }
        .verdict-safe { background: var(--accent-green); color: #000; }
        .verdict-caution { background: var(--accent-orange); color: #000; }
        .verdict-danger { background: var(--accent-red); color: #fff; }
        
        /* Findings Table */
        .findings-table {
            width: 100%;
            font-size: 11px;
            border-collapse: collapse;
        }
        .findings-table th {
            text-align: left;
            padding: 8px;
            background: var(--bg-primary);
            color: var(--text-secondary);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .findings-table td {
            padding: 8px;
            border-bottom: 1px solid var(--border);
        }
        .severity {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 3px;
            font-weight: 600;
            font-size: 10px;
        }
        .severity.critical { background: var(--accent-red); color: #fff; }
        .severity.high { background: var(--accent-orange); color: #000; }
        .severity.medium { background: #9e6a03; color: #fff; }
        .severity.low { background: var(--accent-green); color: #000; }
        
        /* Right Panel */
        .info-table {
            width: 100%;
            font-size: 11px;
        }
        .info-table td {
            padding: 6px 0;
            border-bottom: 1px solid var(--border);
        }
        .info-table td:first-child { color: var(--text-secondary); }
        .info-table td:last-child { text-align: right; color: var(--accent-blue); font-family: monospace; }
        
        /* Scroll Items */
        .scroll-item {
            padding: 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 6px;
            margin-bottom: 8px;
        }
        .scroll-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }
        .scroll-title { font-size: 11px; font-weight: 600; color: var(--accent-blue); }
        .scroll-status {
            font-size: 9px;
            padding: 2px 6px;
            border-radius: 3px;
            background: var(--bg-primary);
            color: var(--text-secondary);
        }
        .scroll-status.active { background: var(--accent-green); color: #000; }
        .scroll-cite { font-size: 10px; color: var(--text-secondary); }
        .scroll-text { font-size: 11px; color: var(--text-primary); margin-top: 6px; }
        
        /* Hash Display */
        .hash-box {
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 10px;
            font-family: monospace;
            font-size: 9px;
            color: var(--accent-blue);
            word-break: break-all;
            margin-top: 10px;
        }
        
        /* Footer */
        .footer {
            text-align: center;
            padding: 15px;
            font-size: 10px;
            color: var(--text-secondary);
            border-top: 1px solid var(--border);
            margin-top: 20px;
        }
        
        @media (max-width: 1200px) {
            .app-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-row">
            <div>
                <div class="brand">FLAME PROTOCOL</div>
                <div class="brand-sub">Client Submission Analysis System v2.0</div>
            </div>
            <div class="header-meta">
                <div>SEC CIK: <span>0001750462</span></div>
                <div>SOX: <span>Â§404</span></div>
                <div>STB: <span>W-435</span></div>
                <div><span class="status-dot"></span>Online</div>
            </div>
        </div>
        <nav class="nav-row">
            <a class="nav-item active">Document Analysis</a>
            <a class="nav-item">Fraud Registry</a>
            <a class="nav-item">Reports</a>
        </nav>
    </header>

    <div class="app-grid">
        <!-- Left Panel -->
        <aside class="panel">
            <div class="section">
                <div class="section-title">Document Upload</div>
                <div class="upload-zone" id="uploadZone">
                    <div class="upload-icon">ğŸ“„</div>
                    <div class="upload-text">Drop files or click to upload</div>
                    <div class="upload-hint">PDF, DOCX, TXT, Images (OCR)</div>
                </div>
                <input type="file" id="fileInput" class="file-input" multiple accept=".pdf,.docx,.doc,.txt,.png,.jpg,.jpeg">
                <div class="progress-bar" id="progressBar"><div class="progress-fill" id="progressFill"></div></div>
                <div class="file-list" id="fileList"></div>
            </div>
            
            <div class="section">
                <div class="section-title">Document Type</div>
                <div class="doc-types">
                    <div class="doc-type selected" data-type="kyc">
                        <div class="doc-type-icon">ğŸªª</div>
                        <div>KYC</div>
                    </div>
                    <div class="doc-type" data-type="cis">
                        <div class="doc-type-icon">ğŸ“‹</div>
                        <div>CIS</div>
                    </div>
                    <div class="doc-type" data-type="pof">
                        <div class="doc-type-icon">ğŸ’°</div>
                        <div>Proof of Funds</div>
                    </div>
                    <div class="doc-type" data-type="other">
                        <div class="doc-type-icon">ğŸ“</div>
                        <div>Other</div>
                    </div>
                </div>
            </div>

            <div class="section">
                <div class="section-title">Federal Registration</div>
                <table class="info-table">
                    <tr><td>SEC CIK</td><td>0001750462</td></tr>
                    <tr><td>STB Reg</td><td>W-435</td></tr>
                    <tr><td>IRS EIN</td><td>98-6101010</td></tr>
                    <tr><td>Trust</td><td>RE384951947US</td></tr>
                    <tr><td>DRS</td><td>1124-911</td></tr>
                </table>
            </div>
        </aside>

        <!-- Center Panel -->
        <main class="panel">
            <div class="input-box">
                <div class="input-header">
                    <span class="input-label">Document Content / Extracted Text</span>
                    <span class="input-meta"><span id="charCount">0</span> characters</span>
                </div>
                <textarea class="input-area" id="contentInput" placeholder="Paste document text directly or upload files above.

The system will analyze for:
â€¢ Fake banking systems (blue/black screens)
â€¢ Impossible amounts (trillions to debit cards)
â€¢ Advance fee fraud patterns
â€¢ Known scam narratives
â€¢ Missing required KYC fields
â€¢ Fraudulent proof of funds
â€¢ Credential harvesting attempts"></textarea>
                <div class="btn-row">
                    <button class="btn btn-primary" onclick="analyzeContent()">ğŸ” Analyze Submission</button>
                    <button class="btn btn-secondary" onclick="clearAll()">Clear</button>
                    <button class="btn btn-secondary" onclick="downloadReport()">ğŸ“„ Download Report</button>
                </div>
            </div>
            
            <div class="results" id="results">
                <div class="section">
                    <div class="section-title">Analysis Results</div>
                    
                    <div class="result-card">
                        <div class="result-header">
                            <span class="result-title">FRAUD RISK ASSESSMENT</span>
                        </div>
                        <div class="result-body">
                            <div class="score-display">
                                <div class="score-value score-low" id="scoreValue">--</div>
                                <div><span class="verdict verdict-safe" id="verdict">AWAITING ANALYSIS</span></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="result-card">
                        <div class="result-header">
                            <span class="result-title">RED FLAGS DETECTED (<span id="flagCount">0</span>)</span>
                        </div>
                        <div class="result-body">
                            <table class="findings-table">
                                <thead>
                                    <tr>
                                        <th>Severity</th>
                                        <th>Category</th>
                                        <th>Description</th>
                                    </tr>
                                </thead>
                                <tbody id="flagsBody">
                                    <tr><td colspan="3" style="color:var(--text-secondary);text-align:center;padding:20px;">No analysis performed yet</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="result-card">
                        <div class="result-header">
                            <span class="result-title">KYC/CIS FIELD VALIDATION</span>
                        </div>
                        <div class="result-body">
                            <table class="findings-table">
                                <thead>
                                    <tr>
                                        <th>Field</th>
                                        <th>Status</th>
                                        <th>Notes</th>
                                    </tr>
                                </thead>
                                <tbody id="kycBody">
                                    <tr><td colspan="3" style="color:var(--text-secondary);text-align:center;padding:20px;">Upload KYC/CIS document to validate</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Right Panel -->
        <aside class="panel">
            <div class="section">
                <div class="section-title">Verification Links</div>
                <div class="scroll-item" style="border-color: var(--accent-blue);">
                    <div class="scroll-header">
                        <div class="scroll-title">SEC File S7-07-19</div>
                        <div class="scroll-status active">VERIFIED</div>
                    </div>
                    <div class="scroll-cite">National Archives Record</div>
                    <div class="scroll-text">Certificate-less Securities Fraud</div>
                    <a href="https://www.sec.gov/comments/s7-07-19/s70719-5724527-186087.htm" target="_blank" style="display:block;margin-top:8px;color:var(--accent-blue);font-size:9px;">sec.gov/comments/s7-07-19</a>
                </div>
                <div class="scroll-item" style="border-color: var(--accent-purple);">
                    <div class="scroll-header">
                        <div class="scroll-title">Slavery Circular 3591</div>
                        <div class="scroll-status active">ARWEAVE</div>
                    </div>
                    <div class="scroll-cite">Permanent Storage</div>
                    <a href="https://app.ardrive.io/#/file/d30addd7-12a3-4f80-af0e-6320d2ba1cc9/view" target="_blank" style="display:block;margin-top:8px;color:var(--accent-purple);font-size:9px;">ArDrive Permanent Link</a>
                </div>
                <div class="scroll-item" style="border-color: var(--accent-green);">
                    <div class="scroll-header">
                        <div class="scroll-title">CertyFile</div>
                        <div class="scroll-status active">SHA-512</div>
                    </div>
                    <a href="https://certyfile.com/en/certification/u-s-attorney-mandatory-enforcement-slavery-circular-no-3591-circular-no-3356-supp-1/" target="_blank" style="display:block;margin-top:8px;color:var(--accent-green);font-size:9px;">Digital Certification</a>
                </div>
            </div>
            
            <div class="section">
                <div class="section-title">Score Methodology</div>
                <table class="info-table">
                    <tr><td>150+</td><td style="color:var(--accent-red);">DEFINITE FRAUD</td></tr>
                    <tr><td>100-149</td><td style="color:var(--accent-red);">HIGHLY SUSPICIOUS</td></tr>
                    <tr><td>50-99</td><td style="color:var(--accent-orange);">SUSPICIOUS</td></tr>
                    <tr><td>25-49</td><td style="color:var(--accent-orange);">QUESTIONABLE</td></tr>
                    <tr><td>&lt;25</td><td style="color:var(--accent-green);">APPEARS LEGIT</td></tr>
                </table>
            </div>
            
            <div class="section">
                <div class="section-title">Document Hash</div>
                <div class="hash-box" id="contentHash">Upload or paste content to generate SHA-256 hash</div>
            </div>
            
            <div class="section">
                <div class="section-title">Report Info</div>
                <table class="info-table">
                    <tr><td>Doc ID</td><td id="docId">--</td></tr>
                    <tr><td>Timestamp</td><td id="timestamp">--</td></tr>
                    <tr><td>Analyst</td><td>FLAME FDS</td></tr>
                </table>
            </div>
        </aside>
    </div>
    
    <div class="footer">
        FLAME Protocol | GB Dynamics Inc | admin@flameqmm.app | 916-891-7552<br>
        SPEC_HASH: 0xf1ab854ae097ac6445bd55ba58d903655ad1f41d6caadaa0a21a9b4c320046be
    </div>

    <script>
        // Initialize PDF.js
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
        
        let selectedDocType = 'kyc';
        
        // Fraud patterns
        const PATTERNS = [
            { regex: /â‚¬?\$?\d{1,3}(,\d{3}){4,}|\d{12,}|trillion|billion.*transfer/i, points: 80, category: 'IMPOSSIBLE_AMOUNT', desc: 'Amount exceeds realistic transfer limits' },
            { regex: /debit card.*\d{6,}|transfer.*to.*card/i, points: 70, category: 'IMPOSSIBLE_METHOD', desc: 'Debit cards cannot receive large transfers' },
            { regex: /send.*gas|pay.*fee.*release|unlock.*fee|activation.*fee/i, points: 70, category: 'ADVANCE_FEE', desc: 'Classic advance fee fraud pattern' },
            { regex: /connecting.*database|loading.*server|processing.*request/i, points: 50, category: 'FAKE_SYSTEM', desc: 'Simulated system messages' },
            { regex: /verif(y|ied|ication).*success|identity.*confirmed/i, points: 50, category: 'FAKE_VERIFICATION', desc: 'Fraudulent verification display' },
            { regex: /approval.*code|reference.*generated|transaction.*id.*:/i, points: 40, category: 'FAKE_APPROVAL', desc: 'Fake approval codes' },
            { regex: /congratulations|you.*won|selected.*winner|lucky.*winner/i, points: 60, category: 'BAIT_LANGUAGE', desc: 'Classic scam opening language' },
            { regex: /urgent|immediately|within.*24.*hours|act.*now|limited.*time/i, points: 40, category: 'URGENCY_TACTIC', desc: 'Pressure tactic' },
            { regex: /guaranteed.*return|100%.*safe|risk.*free|no.*risk/i, points: 60, category: 'FALSE_PROMISE', desc: 'Impossible guarantees' },
            { regex: /western.*union|moneygram|bitcoin.*only|crypto.*only/i, points: 50, category: 'UNTRACEABLE', desc: 'Untraceable payment methods' },
            { regex: /prince|inheritance|lottery|beneficiary.*fund/i, points: 70, category: 'KNOWN_SCAM', desc: 'Known scam narrative' },
            { regex: /enter.*card|enter.*pin|enter.*cvv|enter.*password/i, points: 60, category: 'CREDENTIAL_HARVEST', desc: 'Credential theft attempt' },
            { regex: /bridge.*for.*me|swap.*for.*me|transfer.*for.*me/i, points: 50, category: 'INTERMEDIARY_SCAM', desc: 'Unnecessary intermediary' },
            { regex: /validate.*wallet|verify.*wallet|sync.*wallet|connect.*wallet/i, points: 60, category: 'WALLET_DRAIN', desc: 'Wallet draining attempt' },
            { regex: /do not.*tell|keep.*secret|confidential.*transaction/i, points: 50, category: 'SECRECY', desc: 'Isolation tactic' },
            { regex: /iban.*[a-z]{2}\d{2}/i, points: -10, category: 'LEGITIMATE', desc: 'Valid IBAN format' },
            { regex: /swift.*[a-z]{6}[a-z0-9]{2}/i, points: -10, category: 'LEGITIMATE', desc: 'Valid SWIFT format' },
        ];
        
        // KYC required fields
        const KYC_FIELDS = [
            { name: 'Full Legal Name', regex: /full.*name|legal.*name|name.*:/i },
            { name: 'Date of Birth', regex: /date.*birth|dob|born.*on/i },
            { name: 'Government ID', regex: /passport|driver.*license|national.*id|government.*id/i },
            { name: 'Address', regex: /address|residence|street|city.*state/i },
            { name: 'Phone Number', regex: /phone|mobile|tel:|contact.*number/i },
            { name: 'Email', regex: /email|e-mail|@.*\./i },
            { name: 'Source of Funds', regex: /source.*fund|origin.*fund|wealth.*source/i },
            { name: 'Bank Reference', regex: /bank.*reference|bank.*statement|account.*statement/i },
        ];
        
        // Upload handling
        const uploadZone = document.getElementById('uploadZone');
        const fileInput = document.getElementById('fileInput');
        const progressBar = document.getElementById('progressBar');
        const progressFill = document.getElementById('progressFill');
        const fileList = document.getElementById('fileList');
        const contentInput = document.getElementById('contentInput');
        
        uploadZone.addEventListener('click', () => fileInput.click());
        uploadZone.addEventListener('dragover', (e) => { e.preventDefault(); uploadZone.classList.add('dragover'); });
        uploadZone.addEventListener('dragleave', () => uploadZone.classList.remove('dragover'));
        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.classList.remove('dragover');
            handleFiles(e.dataTransfer.files);
        });
        fileInput.addEventListener('change', (e) => handleFiles(e.target.files));
        
        async function handleFiles(files) {
            progressBar.classList.add('active');
            for (const file of files) {
                addFileItem(file.name, 'processing');
                progressFill.style.width = '30%';
                try {
                    const text = await extractText(file);
                    contentInput.value += (contentInput.value ? '\n\n---\n\n' : '') + text;
                    updateCharCount();
                    updateFileItem(file.name, 'success');
                } catch (err) {
                    updateFileItem(file.name, 'error', err.message);
                }
                progressFill.style.width = '100%';
            }
            setTimeout(() => {
                progressBar.classList.remove('active');
                progressFill.style.width = '0%';
            }, 500);
        }
        
        async function extractText(file) {
            const name = file.name.toLowerCase();
            const type = file.type;
            
            if (type === 'application/pdf' || name.endsWith('.pdf')) {
                return await extractPDF(file);
            } else if (type.includes('wordprocessingml') || name.endsWith('.docx')) {
                return await extractDOCX(file);
            } else if (/\.(png|jpg|jpeg)$/.test(name)) {
                return await extractOCR(file);
            } else if (type === 'text/plain' || name.endsWith('.txt')) {
                return await file.text();
            }
            throw new Error('Unsupported file type');
        }
        
        async function extractPDF(file) {
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
            let text = '';
            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const content = await page.getTextContent();
                text += content.items.map(item => item.str).join(' ') + '\n';
            }
            return text;
        }
        
        async function extractDOCX(file) {
            const arrayBuffer = await file.arrayBuffer();
            const result = await mammoth.extractRawText({ arrayBuffer });
            return result.value;
        }
        
        async function extractOCR(file) {
            const result = await Tesseract.recognize(file, 'eng', {
                logger: m => { if (m.progress) progressFill.style.width = (30 + m.progress * 70) + '%'; }
            });
            return result.data.text;
        }
        
        function addFileItem(name, status) {
            const div = document.createElement('div');
            div.className = 'file-item';
            div.id = 'file-' + name.replace(/[^a-z0-9]/gi, '');
            div.innerHTML = `<span class="file-name">${name}</span><span class="file-status ${status}">${status === 'processing' ? 'Extracting...' : status}</span>`;
            fileList.appendChild(div);
        }
        
        function updateFileItem(name, status, error) {
            const div = document.getElementById('file-' + name.replace(/[^a-z0-9]/gi, ''));
            if (div) {
                const statusEl = div.querySelector('.file-status');
                statusEl.className = 'file-status ' + status;
                statusEl.textContent = status === 'success' ? 'âœ“ Extracted' : error || 'Error';
            }
        }
        
        // Document type selection
        document.querySelectorAll('.doc-type').forEach(el => {
            el.addEventListener('click', () => {
                document.querySelectorAll('.doc-type').forEach(e => e.classList.remove('selected'));
                el.classList.add('selected');
                selectedDocType = el.dataset.type;
            });
        });
        
        // Character count
        contentInput.addEventListener('input', updateCharCount);
        function updateCharCount() {
            document.getElementById('charCount').textContent = contentInput.value.length;
        }
        
        // SHA-256
        async function sha256(message) {
            const msgBuffer = new TextEncoder().encode(message);
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
            return Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2, '0')).join('');
        }
        
        // Clear
        function clearAll() {
            contentInput.value = '';
            updateCharCount();
            fileList.innerHTML = '';
            document.getElementById('results').classList.remove('active');
            document.getElementById('contentHash').textContent = 'Upload or paste content to generate SHA-256 hash';
            document.getElementById('docId').textContent = '--';
            document.getElementById('timestamp').textContent = '--';
        }
        
        // Analyze
        async function analyzeContent() {
            const content = contentInput.value;
            if (!content.trim()) {
                alert('Please upload documents or paste content to analyze');
                return;
            }
            
            // Generate hash
            const hash = await sha256(content);
            document.getElementById('contentHash').textContent = '0x' + hash;
            
            // Generate doc ID
            const docId = 'FDS-' + Date.now().toString(36).toUpperCase();
            document.getElementById('docId').textContent = docId;
            document.getElementById('timestamp').textContent = new Date().toISOString();
            
            // Analyze patterns
            let totalScore = 0;
            const flags = [];
            
            for (const pattern of PATTERNS) {
                if (pattern.regex.test(content)) {
                    totalScore += pattern.points;
                    if (pattern.points > 0) {
                        flags.push({
                            category: pattern.category,
                            desc: pattern.desc,
                            points: pattern.points,
                            severity: pattern.points >= 60 ? 'critical' : pattern.points >= 40 ? 'high' : 'medium'
                        });
                    }
                }
            }
            
            totalScore = Math.max(0, totalScore);
            
            // Update score display
            const scoreEl = document.getElementById('scoreValue');
            scoreEl.textContent = totalScore;
            scoreEl.className = 'score-value ' + (totalScore >= 100 ? 'score-high' : totalScore >= 50 ? 'score-medium' : 'score-low');
            
            // Update verdict
            const verdictEl = document.getElementById('verdict');
            if (totalScore >= 150) {
                verdictEl.textContent = 'DEFINITE FRAUD - DO NOT PROCEED';
                verdictEl.className = 'verdict verdict-danger';
            } else if (totalScore >= 100) {
                verdictEl.textContent = 'HIGHLY SUSPICIOUS';
                verdictEl.className = 'verdict verdict-danger';
            } else if (totalScore >= 50) {
                verdictEl.textContent = 'SUSPICIOUS - VERIFY FURTHER';
                verdictEl.className = 'verdict verdict-caution';
            } else if (totalScore >= 25) {
                verdictEl.textContent = 'QUESTIONABLE';
                verdictEl.className = 'verdict verdict-caution';
            } else {
                verdictEl.textContent = 'APPEARS LEGITIMATE';
                verdictEl.className = 'verdict verdict-safe';
            }
            
            // Update flags
            document.getElementById('flagCount').textContent = flags.length;
            document.getElementById('flagsBody').innerHTML = flags.length ? 
                flags.map(f => `<tr><td><span class="severity ${f.severity}">+${f.points}</span></td><td>${f.category}</td><td>${f.desc}</td></tr>`).join('') :
                '<tr><td colspan="3" style="color:var(--accent-green);text-align:center;padding:20px;">âœ“ No fraud patterns detected</td></tr>';
            
            // KYC validation
            if (selectedDocType === 'kyc' || selectedDocType === 'cis') {
                const kycResults = KYC_FIELDS.map(field => ({
                    name: field.name,
                    found: field.regex.test(content),
                }));
                document.getElementById('kycBody').innerHTML = kycResults.map(r => `
                    <tr>
                        <td>${r.name}</td>
                        <td><span class="severity ${r.found ? 'low' : 'high'}">${r.found ? 'âœ“ FOUND' : 'âœ— MISSING'}</span></td>
                        <td>${r.found ? 'Field detected' : 'Required field not found'}</td>
                    </tr>
                `).join('');
            } else {
                document.getElementById('kycBody').innerHTML = '<tr><td colspan="3" style="color:var(--text-secondary);text-align:center;padding:20px;">Select KYC or CIS document type for field validation</td></tr>';
            }
            
            document.getElementById('results').classList.add('active');
            document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
        }
        
        // Download report
        function downloadReport() {
            const score = document.getElementById('scoreValue').textContent;
            const verdict = document.getElementById('verdict').textContent;
            const docId = document.getElementById('docId').textContent;
            const hash = document.getElementById('contentHash').textContent;
            
            const report = `
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
              FLAME PROTOCOL - CLIENT SUBMISSION ANALYSIS REPORT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Document ID:    ${docId}
Timestamp:      ${new Date().toISOString()}
Document Type:  ${selectedDocType.toUpperCase()}
Content Hash:   ${hash}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                              FRAUD RISK ASSESSMENT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SCORE:          ${score}
VERDICT:        ${verdict}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                              SCORE METHODOLOGY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

150+        DEFINITE FRAUD      DO NOT PROCEED
100-149     HIGHLY SUSPICIOUS   EXTREME CAUTION
50-99       SUSPICIOUS          ADDITIONAL VERIFICATION
25-49       QUESTIONABLE        ENHANCED DUE DILIGENCE
<25         APPEARS LEGIT       STANDARD PROCESSING

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                              VERIFICATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SPEC_HASH: 0xf1ab854ae097ac6445bd55ba58d903655ad1f41d6caadaa0a21a9b4c320046be

SEC CIK:   0001750462
STB:       W-435
EIN:       98-6101010

Contact:   admin@flameqmm.app | 916-891-7552

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                              GB DYNAMICS INC
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
`;
            
            const blob = new Blob([report], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `FLAME_Analysis_${docId}.txt`;
            a.click();
        }
    </script>
</body>
</html>
